{% extends 'base_page.html' %}
{% block title %}–†–µ–¥–∞–∫—Ç–æ—Ä –∫—É—Ä—Å–æ–≤ | MindGrow{% endblock %}

{% block content %}
<div class="ml-64 pt-20 -mt-5 px-6 bg-gradient-to-br from-white to-indigo-50 min-h-screen" x-data="{ section: 'courses' }">
  <h1 class="text-3xl font-bold text-indigo-700 mb-6">üõ† –†–µ–¥–∞–∫—Ç–æ—Ä –∫—É—Ä—Å–æ–≤</h1>

  <!-- –ü–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
  <div class="flex space-x-4 mb-8">

    <button @click="section = 'add'" :class="section === 'add' ? 'bg-indigo-500 text-white' : 'bg-white text-indigo-600'" class="px-4 py-2 rounded shadow hover:bg-indigo-600 hover:text-white transition">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
    <button @click="section = 'add_tests'" :class="section === 'add_tests' ? 'bg-indigo-500 text-white' : 'bg-white text-indigo-600'" class="px-4 py-2 rounded shadow hover:bg-indigo-600 hover:text-white transition">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã</button>
    <button @click="section = 'courses'" :class="section === 'courses' ? 'bg-indigo-500 text-white' : 'bg-white text-indigo-600'" class="px-4 py-2 rounded shadow hover:bg-indigo-600 hover:text-white transition">üìö –ö—É—Ä—Å—ã</button>
    <button @click="section = 'author_courses'" :class="section === 'author_courses' ? 'bg-indigo-500 text-white' : 'bg-white text-indigo-600'" class="px-4 py-2 rounded shadow hover:bg-indigo-600 hover:text-white transition">üìò –ê–≤—Ç–æ—Ä—Å–∫–∏–µ –∫—É—Ä—Å—ã</button>
    <button @click="section = 'lessons'" :class="section === 'lessons' ? 'bg-indigo-500 text-white' : 'bg-white text-indigo-600'" class="px-4 py-2 rounded shadow hover:bg-indigo-600 hover:text-white transition">üìñ –£—Ä–æ–∫–∏</button>
    <button @click="section = 'tests'" :class="section === 'tests' ? 'bg-indigo-500 text-white' : 'bg-white text-indigo-600'" class="px-4 py-2 rounded shadow hover:bg-indigo-600 hover:text-white transition">üß™ –¢–µ—Å—Ç—ã –∏ –≤–æ–ø—Ä–æ—Å—ã</button>
    <button @click="section = 'access'" :class="section === 'access' ? 'bg-indigo-500 text-white' : 'bg-white text-indigo-600'" class="px-4 py-2 rounded shadow hover:bg-indigo-600 hover:text-white transition">üîê –î–æ—Å—Ç—É–ø</button>
    <button @click="section = 'users'" :class="section === 'users' ? 'bg-indigo-500 text-white' : 'bg-white text-indigo-600'" class="px-4 py-2 rounded shadow hover:bg-indigo-600 hover:text-white transition">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>

  </div>
  <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ -->
<div x-show="section === 'add'" class="space-y-10">

  <!-- –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å -->
  <form id="level-form" class="bg-white p-6 rounded-xl shadow space-y-4">
    <h2 class="text-xl font-semibold text-indigo-600">üìê –î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å –¥–ª—è —Å—é–∂–µ—Ç–∞</h2>
    <input name="title" class="input w-full" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è">
    <input name="description" class="input w-full" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
<!--    <input name="chapter_id" class="input w-full" placeholder="ID –≥–ª–∞–≤—ã (chapter_id)" required>-->
    <label>–£—Ä–æ–≤–µ–Ω—å:</label>
    <select name="level" class="input w-full">
      {% for i in range(1, 11) %}
        <option value="{{ i }}">{{ i }}</option>
      {% endfor %}
    </select>
    <label>–®–∞–≥:</label>
    <select name="step" class="input w-full">
      {% for i in range(1, 11) %}
        <option value="{{ i }}">{{ i }}</option>
      {% endfor %}
    </select>
<!--    <input name="step" class="input w-full" placeholder="–®–∞–≥ (step)" required>-->

    <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
    <p id="level-status" class="text-green-600 hidden">‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ!</p>
  </form>

    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–∫–∞ -->
  <form id="lesson-form" class="bg-white p-6 rounded-xl shadow space-y-4">
    <h2 class="text-xl font-semibold text-indigo-600">üìñ –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫</h2>

    <label for="level_id">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å:</label>
    <select name="level_id" id="level_id" class="input w-full" required>
      {% for level in levels %}
        <option value="{{ level.title }}">{{ level.title }}</option>
      {% endfor %}
    </select>
<!--    <input type="number" name="page" placeholder="–ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã" class="input w-full" required>-->
<!--    <input type="number" name="count_pages" placeholder="–í—Å–µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü" class="input w-full" required>-->

    <div id="lesson-content-blocks" class="space-y-6"></div>

    <button type="button" class="btn-secondary" onclick="addContentBlock()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç</button>
    <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —É—Ä–æ–∫</button>
    <p id="lesson-status" class="text-green-600 hidden">‚úÖ –£—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω!</p>
  </form>

  <form id="chapter-form" class="bg-white p-6 rounded-xl shadow space-y-4">
    <h2 class="text-xl font-semibold text-indigo-600">üß© –î–æ–±–∞–≤–∏—Ç—å –≥–ª–∞–≤—É —Ç–µ—Å—Ç–∞</h2>
    <input type="text" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã" class="input w-full" required>
    <textarea name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" class="input w-full"></textarea>
    <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
    <p id="chapter-status" class="text-green-600 hidden">‚úÖ –ì–ª–∞–≤–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!</p>
  </form>
</div>
    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä—Ç—ã -->

<!--  <form id="trait-form" class="bg-white p-6 rounded-xl shadow space-y-4">-->
<!--    <h2 class="text-xl font-semibold text-indigo-600">üß† –î–æ–±–∞–≤–∏—Ç—å —á–µ—Ä—Ç—É</h2>-->
<!--    <input type="text" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —á–µ—Ä—Ç—ã" class="input w-full" required>-->
<!--    <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>-->
<!--    <p id="trait-status" class="text-sm text-green-600 mt-2 hidden">‚úî –ß–µ—Ä—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!</p>-->
<!--  </form>-->

<!--    &lt;!&ndash; –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞ &ndash;&gt;-->
<!--    <form action="{{ url_for('add_author_course') }}" method="POST" class="bg-white p-6 rounded-xl shadow space-y-4">-->
<!--      <h2 class="text-xl font-semibold text-indigo-600">üìò –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä—Å–∫–∏–π –∫—É—Ä—Å</h2>-->
<!--      <input type="text" name="id" placeholder="ID –∫—É—Ä—Å–∞" class="input w-full" required>-->
<!--      <input type="text" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" class="input w-full">-->
<!--      <input type="text" name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" class="input w-full">-->
<!--      <input type="text" name="author" placeholder="–ê–≤—Ç–æ—Ä" class="input w-full">-->
<!--      <input type="text" name="traits" placeholder="–ß–µ—Ä—Ç—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" class="input w-full">-->
<!--      <input type="text" name="first_lesson_id" placeholder="ID –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–∫–∞" class="input w-full">-->
<!--      <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>-->
<!--    </form>-->

<!--    &lt;!&ndash; –î–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª—å-–≤–æ–ø—Ä–æ—Å &ndash;&gt;-->
<!--  <form id="role-form" class="bg-white p-6 rounded-xl shadow space-y-4">-->
<!--    <h2 class="text-xl font-semibold text-indigo-600">üé≠ –î–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª–µ–≤–æ–π –≤–æ–ø—Ä–æ—Å</h2>-->
<!--    <textarea name="text" placeholder="–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞" class="input w-full" required></textarea>-->
<!--    <input type="text" name="options" placeholder="–û–ø—Ü–∏–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" class="input w-full" required>-->
<!--    <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>-->
<!--    <p id="role-status" class="text-green-600 hidden">‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ!</p>-->
<!--  </form>-->

<!--    &lt;!&ndash; –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç &ndash;&gt;-->
<!--  <form id="test-form" class="bg-white p-6 rounded-xl shadow space-y-4">-->
<!--    <h2 class="text-xl font-semibold text-indigo-600">üß™ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç</h2>-->
<!--    <input type="text" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞" class="input w-full" required>-->
<!--    <textarea name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" class="input w-full"></textarea>-->
<!--    <input type="text" name="condition" placeholder="–£—Å–ª–æ–≤–∏—è (ID –¥—Ä—É–≥–∏—Ö —Ç–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" class="input w-full">-->
<!--    <label class="block"><input type="checkbox" name="available"> –î–æ—Å—Ç—É–ø–µ–Ω —Å—Ä–∞–∑—É</label>-->
<!--    <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>-->
<!--    <p id="test-status" class="text-green-600 hidden">‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ!</p>-->
<!--  </form>-->

<!--  &lt;!&ndash; –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å –∫ —Ç–µ—Å—Ç—É &ndash;&gt;-->
<!--  <form id="test-question-form" class="bg-white p-6 rounded-xl shadow space-y-4">-->
<!--    <h2 class="text-xl font-semibold text-indigo-600">‚ùì –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å –∫ —Ç–µ—Å—Ç—É</h2>-->
<!--    <input type="number" name="test_id" placeholder="ID —Ç–µ—Å—Ç–∞" class="input w-full" required>-->
<!--    <input type="number" name="question_index" placeholder="–ò–Ω–¥–µ–∫—Å –≤–æ–ø—Ä–æ—Å–∞" class="input w-full" required>-->
<!--    <textarea name="text" placeholder="–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞" class="input w-full"></textarea>-->
<!--    <input type="text" name="options" placeholder="–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" class="input w-full" required>-->
<!--    <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>-->
<!--    <p id="test-question-status" class="text-green-600 hidden">‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ!</p>-->
<!--  </form>-->
<!--  </div>-->
<!--  &lt;!&ndash; –ö—É—Ä—Å—ã &ndash;&gt;-->
<!--  <div x-show="section === 'courses'" class="space-y-6">-->
<!--    <h2 class="text-xl font-semibold text-indigo-600">üìò –°–ø–∏—Å–æ–∫ –∫—É—Ä—Å–æ–≤</h2>-->
<!--    <div class="bg-white p-6 rounded-xl shadow-md space-y-4">-->
<!--      {% for course in main_courses %}-->
<!--        <div class="flex justify-between items-center border-b pb-3">-->
<!--          <div>-->
<!--            <h3 class="text-lg font-bold">{{ course.title }}</h3>-->
<!--            <p class="text-sm text-gray-600">–ê–≤—Ç–æ—Ä: {{ course.author }} | {{ course.description }}</p>-->
<!--          </div>-->
<!--          <div>-->
<!--            <button class="bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-1 rounded">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>-->
<!--            <button class="bg-red-400 hover:bg-yellow-500 text-white px-3 py-1 rounded">–£–¥–∞–ª–∏—Ç—å</button>-->
<!--          </div>-->
<!--        </div>-->
<!--      {% endfor %}-->
<!--    </div>-->
<!--  </div>-->

<!--  <div x-show="section === 'author_courses'" class="space-y-6">-->
<!--  <h2 class="text-xl font-semibold text-indigo-600">üìò –°–ø–∏—Å–æ–∫ –∫—É—Ä—Å–æ–≤</h2>-->
<!--  <div class="bg-white p-6 rounded-xl shadow-md space-y-4">-->
<!--    {% for course in author_courses %}-->
<!--      <div class="flex justify-between items-center border-b pb-3">-->
<!--        <div>-->
<!--          <h3 class="text-lg font-bold">#{{ course.id }} ‚Äî {{ course.title }}</h3>-->
<!--          <p class="text-sm text-gray-600">–ê–≤—Ç–æ—Ä: {{ course.author }} | {{ course.description }}</p>-->
<!--          <p class="text-sm text-gray-500">–°—Ç–∞—Ç—É—Å: {{ '‚úÖ –¥–æ—Å—Ç—É–ø–µ–Ω' if course.available else '‚ùå —Å–∫—Ä—ã—Ç' }}</p>-->
<!--        </div>-->
<!--          <div class="flex gap-2">-->
<!--            <button class="edit-btn bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-1 rounded"-->
<!--                    data-id="{{ course.id }}"-->
<!--                    data-title="{{ course.title }}"-->
<!--                    data-author="{{ course.author }}"-->
<!--                    data-description="{{ course.description }}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>-->
<!--            <button class="delete-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded"-->
<!--                    data-id="{{ course.id }}">–£–¥–∞–ª–∏—Ç—å</button>-->
<!--          </div>-->
<!--      </div>-->
<!--    {% endfor %}-->
<!--  </div>-->
<!--</div>-->


<!--  &lt;!&ndash; –£—Ä–æ–∫–∏ &ndash;&gt;-->
<!--  <div x-show="section === 'lessons'" class="space-y-6">-->
<!--    <h2 class="text-xl font-semibold text-indigo-600">üìñ –£—Ä–æ–∫–∏ –ø–æ –∫—É—Ä—Å–∞–º</h2>-->
<!--    <div class="bg-white p-6 rounded-xl shadow-md space-y-4">-->
<!--      {% for lesson in lessons %}-->
<!--        <div class="border-b pb-3">-->
<!--          <div class="flex justify-between items-center">-->
<!--            <h3 class="font-semibold">{{ lesson.title }} (ID: {{ lesson.id }})</h3>-->
<!--            <span class="text-sm text-gray-500">{{ lesson.type }}</span>-->
<!--          </div>-->
<!--          <p class="text-sm text-gray-600 mt-1">–ö—É—Ä—Å: {{ lesson.course_id }}</p>-->
<!--          <div>-->
<!--            <button class="bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-1 rounded">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>-->
<!--            <button class="bg-red-400 hover:bg-yellow-500 text-white px-3 py-1 rounded">–£–¥–∞–ª–∏—Ç—å</button>-->
<!--          </div>-->
<!--        </div>-->
<!--      {% endfor %}-->
<!--    </div>-->
<!--  </div>-->

<!--  &lt;!&ndash; –¢–µ—Å—Ç—ã &ndash;&gt;-->
<!--  <div x-show="section === 'tests'" class="space-y-6">-->
<!--  <h2 class="text-xl font-semibold text-indigo-600">üß™ –°–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤</h2>-->
<!--  <div class="bg-white p-6 rounded-xl shadow-md space-y-6">-->
<!--    {% for test in tests %}-->
<!--      <div class="border-b pb-4">-->
<!--        <div class="flex justify-between items-center mb-2">-->
<!--          <div>-->
<!--            <h3 class="text-lg font-bold">#{{ test.id }} ‚Äî {{ test.title }}</h3>-->
<!--            <p class="text-sm text-gray-600">{{ test.description }}</p>-->
<!--            <p class="text-sm text-gray-500">–°—Ç–∞—Ç—É—Å: {{ '‚úÖ –¥–æ—Å—Ç—É–ø–µ–Ω' if test.available else '‚ùå —Å–∫—Ä—ã—Ç' }}</p>-->
<!--          </div>-->
<!--          <button class="bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-1 rounded">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>-->
<!--        </div>-->
<!--        {% if test.questions %}-->
<!--        <ul class="list-disc ml-6 text-sm space-y-1 text-gray-700">-->
<!--          {% for q in test.questions %}-->
<!--            <li><strong>{{ q.question_index }}.</strong> {{ q.text }}</li>-->
<!--          {% endfor %}-->
<!--        </ul>-->
<!--        {% else %}-->
<!--        <p class="text-sm text-gray-400 ml-6">–ù–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤</p>-->
<!--        {% endif %}-->
<!--      </div>-->
<!--    {% endfor %}-->
<!--  </div>-->
<!--</div>-->


<!--  &lt;!&ndash; –î–æ—Å—Ç—É–ø &ndash;&gt;-->
<!--  <div x-show="section === 'access'" class="space-y-6">-->
<!--    <h2 class="text-xl font-semibold text-indigo-600">üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞</h2>-->
<!--    <div class="bg-white p-6 rounded-xl shadow-md">-->
<!--      <p class="text-sm text-gray-600">–ó–¥–µ—Å—å –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫—É—Ä—Å–∞–º–∏, —Ç–µ—Å—Ç–∞–º–∏ –∏ –≥–ª–∞–≤–∞–º–∏. (–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞...)</p>-->
<!--    </div>-->
<!--  </div>-->

<!--  <div x-show="section === 'users'" class="space-y-6">-->
<!--  <h2 class="text-xl font-semibold text-indigo-600">üë• –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>-->
<!--  <div class="bg-white p-6 rounded-xl shadow-md space-y-4">-->
<!--    {% for user in users %}-->
<!--      <div class="flex justify-between items-center border-b pb-3">-->
<!--        <div>-->
<!--          <h3 class="text-lg font-bold">{{ user.name }}</h3>-->
<!--          <p class="text-sm text-gray-600">{{ user.email }} | –°—Ç–∞—Ç—É—Å: {{ user.status }}</p>-->
<!--        </div>-->
<!--        <div>-->
<!--            <button class="bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-1 rounded">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>-->
<!--            <button class="bg-red-400 hover:bg-yellow-500 text-white px-3 py-1 rounded">–£–¥–∞–ª–∏—Ç—å</button>-->
<!--          </div>-->
<!--      </div>-->
<!--    {% endfor %}-->
<!--  </div>-->
<!--</div>-->
  <div x-show="section === 'add_tests'" class="space-y-10">

    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º—ã —Ç–µ—Å—Ç–∞ -->
    <form id="theme-form" class="bg-white p-6 rounded-xl shadow space-y-4">
      <h2 class="text-xl font-semibold text-indigo-600">üß† –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–º—É —Ç–µ—Å—Ç–∞</h2>
      <input name="title" class="input w-full" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã" required>
      <textarea name="description" class="input w-full" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–º—ã (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
<!--      <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–º—É</button>-->
<!--      <p id="theme-status" class="text-green-600 hidden">‚úÖ –¢–µ–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!</p>-->
    </form>

    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ -->
    <div class="p-4 border rounded bg-blue-50 space-y-2">
  <label class="inline-flex items-center">
    <input type="checkbox" id="use-default-answers" class="mr-2">
    –ó–∞–¥–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
  </label>
  <div id="default-answers-block" class="space-y-2 hidden">
    <input class="input w-full" name="default_answer_0" placeholder="–û—Ç–≤–µ—Ç">
    <input class="input w-full" name="default_score_0" type="number" placeholder="–û—á–∫–∏">
    <button type="button" class="btn-secondary" onclick="addDefaultAnswer()">‚ûï –û—Ç–≤–µ—Ç</button>
  </div>
</div>
    <div id="questions-block" class="space-y-6">
      <h3 class="text-lg font-bold text-indigo-700">‚ùì –í–æ–ø—Ä–æ—Å—ã</h3>
    </div>
    <button type="button" class="btn-secondary" onclick="addQuestion()">‚ûï –í–æ–ø—Ä–æ—Å</button>

    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤ -->
    <div id="skills-block" class="space-y-6 mt-10">
      <h3 class="text-lg font-bold text-indigo-700">üèÖ –ù–∞–≤—ã–∫–∏</h3>
    </div>
    <button type="button" class="btn-secondary" onclick="addSkill()">‚ûï –ù–∞–≤—ã–∫</button>

    <button type="button" class="btn-primary mt-6" onclick="saveTest()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ—Å—Ç</button>
    <p id="test-save-status" class="text-green-600 hidden">‚úÖ –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω!</p>

  </div>

</div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const forms = [
    { id: "trait-form", url: "/add_trait", status: "trait-status" },
    { id: "course-form", url: "/add_author_course", status: "course-status" },
    { id: "lesson-form", url: "/add_lesson", status: "lesson-status" },
    { id: "level-form", url: "/add_level", status: "level-status" },
    { id: "role-form", url: "/add_role_question", status: "role-status" },
    { id: "test-form", url: "/add_test", status: "test-status" },
    { id: "test-question-form", url: "/add_test_question", status: "test-question-status" },
    { id: "chapter-form", url: "/add_test_chapter", status: "chapter-status" }
  ];

  forms.forEach(({ id, url, status }) => {
    const form = document.getElementById(id);
    const statusEl = document.getElementById(status);
    if (!form || !statusEl) return;

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const formData = new FormData(this);

      fetch(url, {
        method: "POST",
        body: formData
      })
      .then(async res => {
        if (!res.ok) {
          const errorData = await res.json().catch(() => ({}));
          const message = errorData.error || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞";
          throw new Error(message);
        }
        return res.text();
      })
      .then(() => {
        statusEl.classList.remove("hidden");
        this.reset();
        setTimeout(() => statusEl.classList.add("hidden"), 3000);
      })
      .catch(err => {
        alert("‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: " + err.message);
      });
    });
  });
});

document.addEventListener("DOMContentLoaded", () => {
  // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞
  document.querySelectorAll(".edit-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const id = btn.dataset.id;
      const newTitle = prompt("–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:", btn.dataset.title);
      const newAuthor = prompt("–ê–≤—Ç–æ—Ä:", btn.dataset.author);
      const newDesc = prompt("–û–ø–∏—Å–∞–Ω–∏–µ:", btn.dataset.description);

      if (!newTitle || !newAuthor) return;

      const formData = new FormData();
      formData.append("id", id);
      formData.append("title", newTitle);
      formData.append("author", newAuthor);
      formData.append("description", newDesc);

      fetch("/update_author_course", {
        method: "POST",
        body: formData
      }).then(() => location.reload());
    });
  });

  // –£–¥–∞–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞
  document.querySelectorAll(".delete-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      if (!confirm("–£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å?")) return;

      const formData = new FormData();
      formData.append("id", btn.dataset.id);

      fetch("/delete_author_course", {
        method: "POST",
        body: formData
      }).then(() => location.reload());
    });
  });
});
function addContentBlock() {
  const container = document.getElementById("lesson-content-blocks");
  const index = container.children.length;

  const block = document.createElement("div");
  block.classList.add("p-4", "bg-gray-50", "rounded", "border", "space-y-2");
  block.innerHTML = `
    <label class="block font-semibold">–¢–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞:</label>
    <select name="items[${index}][mode]" class="input w-full type-select" onchange="toggleContentType(this, ${index})">
      <option value="content">–ö–æ–Ω—Ç–µ–Ω—Ç</option>
      <option value="question">–í–æ–ø—Ä–æ—Å</option>
    </select>

    <div id="content-${index}" class="space-y-2">
      <select name="items[${index}][type]" class="input w-full">
        <option value="text">–¢–µ–∫—Å—Ç</option>
        <option value="image">–ö–∞—Ä—Ç–∏–Ω–∫–∞</option>
        <option value="video">–í–∏–¥–µ–æ</option>
      </select>
      <input type="text" name="items[${index}][content]" placeholder="–¢–µ–∫—Å—Ç –∏–ª–∏ —Å—Å—ã–ª–∫–∞" class="input w-full">
    </div>

    <div id="question-${index}" class="space-y-2 hidden">
      <input type="text" name="items[${index}][question]" placeholder="–í–æ–ø—Ä–æ—Å" class="input w-full">
      <input type="text" name="items[${index}][answer1]" placeholder="–û—Ç–≤–µ—Ç" class="input w-full">
      <input type="number" name="items[${index}][price1]" placeholder="–¶–µ–Ω–∞" class="input w-full">

    </div>
  `;

  container.appendChild(block);
}

function toggleContentType(select, index) {
  const mode = select.value;
  document.getElementById(`content-${index}`).classList.toggle("hidden", mode !== "content");
  document.getElementById(`question-${index}`).classList.toggle("hidden", mode !== "question");
}
let questionIndex = 0;
let skillIndex = 0;

function addQuestion() {
  const container = document.getElementById("questions-block");

  const block = document.createElement("div");
  block.className = "p-4 border rounded bg-gray-50 space-y-2";
  block.innerHTML = `
    <input class="input w-full" name="question_${questionIndex}" placeholder="–í–æ–ø—Ä–æ—Å">
    <div id="answers_${questionIndex}" class="space-y-2"></div>
    <button type="button" class="btn-secondary" onclick="addAnswer(${questionIndex})">‚ûï –û—Ç–≤–µ—Ç</button>
  `;

  container.appendChild(block);

  const answersBlock = block.querySelector(`#answers_${questionIndex}`);
  const useDefaults = document.getElementById("use-default-answers").checked;

  if (useDefaults) {
    const defaults = document.querySelectorAll("#default-answers-block input");
    for (let i = 0; i < defaults.length; i += 2) {
      const aVal = defaults[i].value;
      const sVal = defaults[i + 1].value;

      answersBlock.insertAdjacentHTML("beforeend", `
        <input class="input w-full" name="answer_${questionIndex}_${i / 2}" value="${aVal}" placeholder="–û—Ç–≤–µ—Ç">
        <input class="input w-full" name="score_${questionIndex}_${i / 2}" value="${sVal}" type="number" placeholder="–û—á–∫–∏">
      `);
    }
  } else {
    // –°—Ç–∞—Ä—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç, –µ—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω
    answersBlock.innerHTML = `
      <input class="input w-full" name="answer_${questionIndex}_0" placeholder="–û—Ç–≤–µ—Ç">
      <input class="input w-full" name="score_${questionIndex}_0" type="number" placeholder="–û—á–∫–∏">
    `;
  }

  questionIndex++;
}


function addAnswer(qIdx) {
  const answersBlock = document.getElementById(`answers_${qIdx}`);
  const count = answersBlock.children.length / 2;

  answersBlock.insertAdjacentHTML('beforeend', `
    <input class="input w-full" name="answer_${qIdx}_${count}" placeholder="–û—Ç–≤–µ—Ç">
    <input class="input w-full" name="score_${qIdx}_${count}" type="number" placeholder="–û—á–∫–∏">
  `);
}

function addSkill() {
  const container = document.getElementById("skills-block");
  const block = document.createElement("div");
  block.className = "p-4 border rounded bg-gray-50 space-y-2";
  block.innerHTML = `
    <input class="input w-full" name="skill_${skillIndex}_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–≤—ã–∫–∞">
    <input class="input w-full" name="skill_${skillIndex}_questions" placeholder="–ù–æ–º–µ—Ä–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 0,2,3)">
  `;
  container.appendChild(block);
  skillIndex++;
}

function saveTest() {
  const formData = new FormData();
  document.querySelectorAll('#questions-block input, #skills-block input, #theme-form input, #theme-form textarea').forEach(el => {
    if (el.name) formData.append(el.name, el.value);
  });

  fetch("/save_test_full", {
    method: "POST",
    body: formData
  })
    .then(res => {
      if (!res.ok) throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏");
      return res.text();
    })
    .then(() => {
      document.getElementById("test-save-status").classList.remove("hidden");
      setTimeout(() => document.getElementById("test-save-status").classList.add("hidden"), 3000);
    })
    .catch(err => alert("‚ùå " + err.message));
}
  document.getElementById("use-default-answers").addEventListener("change", function () {
  document.getElementById("default-answers-block").classList.toggle("hidden", !this.checked);
});

function addDefaultAnswer() {
  const container = document.getElementById("default-answers-block");
  const count = (container.querySelectorAll("input").length) / 2;

  container.insertAdjacentHTML("beforeend", `
    <input class="input w-full" name="default_answer_${count}" placeholder="–û—Ç–≤–µ—Ç">
    <input class="input w-full" name="default_score_${count}" type="number" placeholder="–û—á–∫–∏">
  `);
}
</script>

{% endblock %}
